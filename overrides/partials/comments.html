{% if config.extra.comments.enabled and page.meta.comments %}
<div class="comments">
  <h2>评论</h2>
  <div class="giscus"></div>
  <script>
    // 监听主题切换
    const changeGiscusTheme = () => {
      const theme = document.querySelector('[data-md-color-scheme]')?.getAttribute('data-md-color-scheme') || 'light'
      const giscusFrame = document.querySelector('.giscus-frame')
      if (giscusFrame) {
        giscusFrame.contentWindow.postMessage({
          giscus: {
            setConfig: {
              theme: theme === 'slate' ? 'dark' : 'light'
            }
          }
        }, 'https://giscus.app')
      }
    }

    // 初始化 giscus
    const loadGiscus = () => {
      const theme = document.querySelector('[data-md-color-scheme]')?.getAttribute('data-md-color-scheme') || 'light'
      const script = document.createElement('script')
      script.src = 'https://giscus.app/client.js'
      script.setAttribute('data-repo', 'FreemanKevin/Meowtopia')
      script.setAttribute('data-repo-id', 'R_kgDONiJ7mQ')
      script.setAttribute('data-category', 'General')
      script.setAttribute('data-category-id', 'DIC_kwDONiJ7mc4ClzxZ')
      script.setAttribute('data-mapping', 'pathname')
      script.setAttribute('data-strict', '0')
      script.setAttribute('data-reactions-enabled', '1')
      script.setAttribute('data-emit-metadata', '0')
      script.setAttribute('data-input-position', 'bottom')
      script.setAttribute('data-theme', theme === 'slate' ? 'dark' : 'light')
      script.setAttribute('data-lang', 'zh-CN')
      script.crossOrigin = 'anonymous'
      script.async = true
      document.querySelector('.giscus').appendChild(script)
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', loadGiscus)

    // 监听主题切换按钮
    const observer = new MutationObserver(() => {
      changeGiscusTheme()
    })

    observer.observe(document.querySelector('body'), {
      attributes: true,
      attributeFilter: ['data-md-color-scheme']
    })
  </script>
</div>
{% endif %} 